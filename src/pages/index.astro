---
import Layout from '../layouts/Layout.astro';
import Avatar from '../components/Avatar.astro';
import SocialLinks from '../components/SocialLinks.astro';
import ParticleBackground from '../components/ParticleBackground.astro';
import ThreeBackground from '../components/ThreeBackground.astro';
import TypeWriter from '../components/TypeWriter.astro';
import MouseTrail from '../components/MouseTrail.astro';

const socialLinks = [
  {
    name: 'GitHub',
    url: 'https://github.com/1m1ng',
    icon: 'github',
    color: 'blue',
  },
  {
    name: 'å°é¸¡çª',
    url: 'https://dashboard.1m1ng.net',
    icon: 'server',
    color: 'purple',
  },
  {
    name: 'Bilibili',
    url: 'https://space.bilibili.com/176271763',
    icon: 'bilibili',
    color: 'cyan',
  },
];
---

<Layout title="ç°æœºå–µå–µå–µ ã® ä¸ªäººä¸»é¡µ">
  <!-- 3D èƒŒæ™¯ -->
  <ThreeBackground />
  
  <!-- ç²’å­æ•ˆæœ -->
  <ParticleBackground />
  
  <!-- é¼ æ ‡è½¨è¿¹ -->
  <MouseTrail />

  <!-- ä¸»èƒŒæ™¯å›¾ -->
  <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-20">
    <div 
      class="w-full h-full bg-tilt"
      id="bgTilt"
      data-desktop="/background.jpg"
      data-mobile="/mobile.jpg"
      style="background-position: center; background-repeat: no-repeat; background-attachment: fixed; transition: background-position 0.3s ease-out;"
    ></div>
    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-black/70 via-black/50 to-transparent pointer-events-none"></div>
  </div>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="relative z-10 min-h-screen flex items-center md:items-start pt-8 md:pt-32">
    <div class="w-full md:w-2/3 h-full flex flex-col items-center justify-start px-4 md:px-8 lg:px-12 py-4 md:py-8">
        
        <!-- æ—¶é—´æ˜¾ç¤ºåœ¨å¡ç‰‡ä¸Šæ–¹ -->
        <div class="time-display mb-4 md:mb-8 animate-fade-in-up">
          <div id="clock" class="time-text">
            <span class="time-digit" data-type="hours">00</span><span class="time-colon">:</span><span class="time-digit" data-type="minutes">00</span><span class="time-colon">:</span><span class="time-digit" data-type="seconds">00</span>
          </div>
          <div id="date" class="date-text">----å¹´--æœˆ--æ—¥</div>
        </div>
        
        <!-- ä¸»å¡ç‰‡ -->
        <div class="glass-card p-5 md:p-10 lg:p-12 rounded-2xl md:rounded-3xl animate-fade-in-up w-full max-w-2xl">
          
          <!-- å¤´åƒå’Œåå­— -->
          <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8 mb-6 md:mb-8">
            <Avatar 
              src="https://www.gravatar.com/avatar/ee6bfa6ae8b5e67dd429e5658ad1ab8d?s=256&d=identicon"
              alt="ç°æœºå–µå–µå–µ"
            />
            
            <div class="text-center md:text-left">
              <TypeWriter text="ç°æœºå–µå–µå–µ" class="text-2xl md:text-4xl lg:text-6xl font-bold tracking-tight mb-2 md:mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-cyan-200" />
              <p class="text-gray-300 text-sm md:text-lg lg:text-xl font-light tracking-widest uppercase animate-fade-in-up" style="animation-delay: 0.5s; opacity: 0;">
                ä¸€åªä¼šç‚¹ç¼–ç¨‹åˆä¼šå–µå–µå–µçš„å¤§å­¦ç‰²
              </p>
            </div>
          </div>

          <!-- åˆ†å‰²çº¿ -->
          <div class="w-full h-[1px] bg-gradient-to-r from-transparent via-white/30 to-transparent my-4 md:my-8 animate-fade-in-up" style="animation-delay: 0.3s; opacity: 0;"></div>
          
          <!-- ç®€ä»‹ -->
          <p class="text-gray-300 text-sm md:text-lg leading-relaxed mb-6 md:mb-8 animate-fade-in-up" style="animation-delay: 0.4s; opacity: 0;">
            ç”Ÿå‘½åœ¨äºæŠ˜è…¾ï¼Œçƒ­è¡·äºæ£è…¾å°é¸¡ï¼Œæ‹¥æœ‰å±äºè‡ªå·±çš„å°é¸¡çªã€‚æ—¢èœåˆçˆ±ç©ï¼Œå€’å¤´å°±ç¡è§‰ã€‚<br/>
            æ„¿è¿™ç”Ÿä½ æˆ‘ä¸€åˆ‡å®‰å¥½ï¼Œå°‘ç‚¹404ï¼Œå¤šç‚¹502ã€‚å–µå–µå–µï¼
          </p>

          <!-- ç¤¾äº¤é“¾æ¥ -->
          <div class="animate-fade-in-up" style="animation-delay: 0.5s; opacity: 0;">
            <SocialLinks links={socialLinks} />
          </div>
        </div>
    </div>
  </main>

  <!-- é¡µè„š -->
  <footer class="fixed bottom-4 left-0 right-0 text-center text-gray-400/60 text-sm z-20">
    <p class="animate-fade-in-up" style="animation-delay: 1.2s; opacity: 0;">
      Made with ğŸ’œ by ç°æœºå–µå–µå–µ Â· Â© 2025
    </p>
  </footer>
</Layout>

<script>
  // èƒŒæ™¯è§†å·®æ•ˆæœå’Œå“åº”å¼èƒŒæ™¯è®¾ç½®
  const bgElement = document.querySelector('#bgTilt') as HTMLElement;
  
  if (bgElement) {
    // æ ¹æ®å›¾ç‰‡å°ºå¯¸å’Œçª—å£å°ºå¯¸åŠ¨æ€è®¡ç®—æœ€ä¼˜çš„background-size
    const calculateOptimalBackgroundSize = (imgUrl: string) => {
      const img = new Image();
      img.onload = () => {
        const imgAspectRatio = img.width / img.height;
        const windowAspectRatio = window.innerWidth / window.innerHeight;
        
        // è®¡ç®—å®½åº¦å’Œé«˜åº¦ï¼Œç¡®ä¿ä¸¤ä¸ªæ–¹å‘éƒ½èƒ½è§†å·®ç§»åŠ¨
        let widthPercent: number;
        let heightPercent: number;
        
        if (imgAspectRatio > windowAspectRatio) {
          // å›¾ç‰‡ç›¸å¯¹è¾ƒå®½
          widthPercent = Math.max(130, (imgAspectRatio / windowAspectRatio) * 110);
          heightPercent = 100;
        } else {
          // å›¾ç‰‡ç›¸å¯¹è¾ƒé«˜
          widthPercent = 100;
          heightPercent = Math.max(130, (windowAspectRatio / imgAspectRatio) * 110);
        }
        
        // ä½†ä¸¤ä¸ªæ–¹å‘éƒ½è‡³å°‘ç•™å‡ºè§†å·®ç©ºé—´
        widthPercent = Math.max(widthPercent, 120);
        heightPercent = Math.max(heightPercent, 120);
        
        bgElement.style.backgroundSize = `${widthPercent}% ${heightPercent}%`;
      };
      img.src = imgUrl;
    };
    
    // è®¾ç½®åˆå§‹èƒŒæ™¯
    const setBackground = () => {
      const isMobile = window.innerWidth < 768;
      const bgImage = isMobile ? bgElement.dataset.mobile : bgElement.dataset.desktop;
      bgElement.style.backgroundImage = `url('${bgImage}')`;
      calculateOptimalBackgroundSize(bgImage!);
    };
    
    setBackground();
    window.addEventListener('resize', setBackground);
    
    document.addEventListener('mousemove', (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 2;
      const y = (e.clientY / window.innerHeight - 0.5) * 2;
      
      const moveX = 50 + x * 8;
      const moveY = 50 + y * 8;
      
      bgElement.style.backgroundPosition = `${moveX}% ${moveY}%`;
    });
  }

  // ç®€æ´ä¼˜é›…çš„æ—¶é’Ÿ
  let lastSeconds = '';
  
  function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    
    const clockEl = document.getElementById('clock');
    const dateEl = document.getElementById('date');
    
    if (clockEl) {
      const hoursEl = clockEl.querySelector('[data-type="hours"]');
      const minutesEl = clockEl.querySelector('[data-type="minutes"]');
      const secondsEl = clockEl.querySelector('[data-type="seconds"]');
      
      if (hoursEl) hoursEl.textContent = hours;
      if (minutesEl) minutesEl.textContent = minutes;
      if (secondsEl) {
        secondsEl.textContent = seconds;
        // æ¯ç§’æ·»åŠ è·³åŠ¨æ•ˆæœ
        if (seconds !== lastSeconds) {
          secondsEl.classList.add('pulse');
          setTimeout(() => secondsEl.classList.remove('pulse'), 200);
          lastSeconds = seconds;
        }
      }
    }
    
    if (dateEl) {
      dateEl.textContent = now.toLocaleDateString('zh-CN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        weekday: 'long'
      });
    }
  }
  
  updateClock();
  setInterval(updateClock, 1000);
</script>

<style>
  .glass-card {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  }

  /* æ—¶é—´æ˜¾ç¤ºæ ·å¼ */
  .time-display {
    font-family: 'Righteous', 'Arial Black', sans-serif;
    text-align: center;
  }

  .time-text {
    display: flex;
    align-items: baseline;
    justify-content: center;
  }

  .time-digit {
    font-family: 'Righteous', 'Arial Black', sans-serif;
    font-size: 3rem;
    font-weight: 400;
    letter-spacing: 2px;
    color: transparent;
    background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 30%, #7dd3fc 60%, #38bdf8 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    animation: gradient-flow 4s ease infinite;
    text-shadow: 
      0 0 30px rgba(125, 211, 252, 0.5),
      0 0 60px rgba(125, 211, 252, 0.3),
      0 0 90px rgba(56, 189, 248, 0.2);
    font-variant-numeric: tabular-nums;
    transition: all 0.2s ease;
    display: inline-block;
    min-width: 54px;
    text-align: center;
    filter: drop-shadow(0 0 15px rgba(125, 211, 252, 0.4));
  }

  @media (min-width: 768px) {
    .time-digit {
      font-size: 10rem;
      letter-spacing: 6px;
      min-width: 180px;
    }
  }

  @keyframes gradient-flow {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  .time-digit[data-type="seconds"] {
    font-size: 2.2rem;
    min-width: 40px;
    opacity: 0.9;
  }

  @media (min-width: 768px) {
    .time-digit[data-type="seconds"] {
      font-size: 7rem;
      min-width: 130px;
    }
  }

  .time-digit.pulse {
    transform: scale(1.06);
    filter: drop-shadow(0 0 25px rgba(125, 211, 252, 0.7));
  }

  .time-colon {
    font-family: 'Righteous', 'Arial Black', sans-serif;
    font-size: 2.5rem;
    font-weight: 400;
    color: transparent;
    background: linear-gradient(135deg, #e0f2fe 0%, #7dd3fc 100%);
    -webkit-background-clip: text;
    background-clip: text;
    margin: 0 2px;
    animation: colon-blink 1s ease-in-out infinite;
    filter: drop-shadow(0 0 12px rgba(125, 211, 252, 0.3));
  }

  @media (min-width: 768px) {
    .time-colon {
      font-size: 8rem;
      margin: 0 8px;
    }
  }

  @keyframes colon-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .date-text {
    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    font-size: 0.9rem;
    font-weight: 300;
    color: rgba(224, 242, 254, 0.7);
    margin-top: 8px;
    letter-spacing: 2px;
    text-shadow: 0 0 15px rgba(125, 211, 252, 0.3);
  }

  @media (min-width: 768px) {
    .date-text {
      font-size: 1.8rem;
      margin-top: 16px;
      letter-spacing: 6px;
    }
  }

  /* æ‰‹æœºç«¯éšè—é¼ æ ‡è½¨è¿¹æ•ˆæœ */
  @media (max-width: 767px) {
    :global(.mouse-trail-canvas) {
      display: none !important;
    }
  }
</style>
